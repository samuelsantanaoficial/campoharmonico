<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Campo Harm么nico</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

	<link rel="icon" type="image/png" href="favicon/favicon-96x96.png" sizes="96x96" />
	<link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
	<link rel="shortcut icon" href="favicon/favicon.ico" />
	<link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png" />
	<link rel="manifest" href="favicon/site.webmanifest" />
	<script>
	if ('serviceWorker' in navigator) {
		window.addEventListener('load', () => {
		navigator.serviceWorker.register('/sw.js')
			.then(registration => {
			console.log('Service Worker registrado com sucesso:', registration);
			})
			.catch(error => {
			console.log('Falha ao registrar o Service Worker:', error);
			});
		});
	}
	</script>
</head>
<body>

	<div class="container mt-5">
		<h1 class="mb-4 text-primary">Gerador de Campo Harm么nico</h1>

		<div class="row g-3 align-items-end mb-4">
			<div class="col-md-3">
				<label for="nota" class="form-label">Tom:</label>
				<select id="nota" class="form-select" onchange="gerarCampo()">
					<option value="Cb">Cb</option>
					<option value="Gb">Gb</option>
					<option value="Db">Db</option>
					<option value="Ab">Ab</option>
					<option value="Eb">Eb</option>
					<option value="Bb">Bb</option>
					<option value="F">F</option>
					<option value="C" selected>C</option>
					<option value="G">G</option>
					<option value="D">D</option>
					<option value="A">A</option>
					<option value="E">E</option>
					<option value="B">B</option>
					<option value="F#">F#</option>
					<option value="C#">C#</option> 
				</select>
			</div>
			
			<div class="col-md-5">
				<label for="escala" class="form-label">Escala:</label>
				<select id="escala" class="form-select" onchange="gerarCampo()">
					<option value="major">Maior</option>
					<option value="minor">Menor (Natural)</option>
					<option value="harmonic minor">Menor (Harm么nica)</option>
					<option value="melodic minor">Menor (Mel贸dica)</option>
				</select>
			</div>

			<div class="col-md-4">
				<button onclick="gerarCampo()" class="btn btn-primary w-100">Gerar Tabela</button>
			</div>
		</div>

		<div class="table-responsive">
			<table id="tabelaHarmonica" class="table table-bordered table-hover text-nowrap">
				<tr id="linhaGraus"></tr>
				<tr id="linhaAcordes"></tr>
				<tr id="linhaNotas"></tr>
				<tr id="linhaModos"></tr>
			</table>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/tonal/browser/tonal.min.js"></script>
	
	<script>
		function formatarExtensao(intervalo) {
			const mapa = {
				"2m": "b9", 
				"2M": "9", 
				"2A": "#9",
				"4P": "11", 
				"4A": "#11", 
				"4d": "b11",
				"6m": "b13", 
				"6M": "13", 
				"6A": "#13"
			};
			return mapa[intervalo] || intervalo;
		}

		function gerarCampo() {
			const nota = document.getElementById('nota').value;
			const tipoEscala = document.getElementById('escala').value;
			
			const linhaGraus = document.getElementById('linhaGraus');
			const linhaAcordes = document.getElementById('linhaAcordes');
			const linhaNotas = document.getElementById('linhaNotas');
			const linhaModos = document.getElementById('linhaModos');
			
			linhaGraus.innerHTML = '<td class="header-col">Grau</td>';
			linhaAcordes.innerHTML = '<td class="header-col">Acorde</td>';
			linhaNotas.innerHTML = '<td class="header-col">Notas</td>';
			linhaModos.innerHTML = '<td class="header-col">Modo</td>';

			const graus = ["I", "II", "III", "IV", "V", "VI", "VII"];

			try {
				let keyType = tipoEscala === "minor" ? "natural" : tipoEscala.split(' ')[0];
				let chords = (tipoEscala === "major") ? Tonal.Key.majorKey(nota).chords : Tonal.Key.minorKey(nota)[keyType].chords;

				const escalaNotes = Tonal.Scale.get(`${nota} ${tipoEscala}`).notes;
				const modosDinamicos = Tonal.Scale.modeNames(`${nota} ${tipoEscala}`);

				modosDinamicos.forEach((infoModo, i) => {
					const fundamental = infoModo[0];
					const acordeNome = chords[i];

					const n9 = escalaNotes[(i + 1) % 7];
					const n11 = escalaNotes[(i + 3) % 7];
					const n13 = escalaNotes[(i + 5) % 7];

					const ext9 = formatarExtensao(Tonal.Interval.distance(fundamental, n9));
					const ext11 = formatarExtensao(Tonal.Interval.distance(fundamental, n11));
					const ext13 = formatarExtensao(Tonal.Interval.distance(fundamental, n13));

					const cellGrau = document.createElement('th');
					cellGrau.textContent = graus[i];
					linhaGraus.appendChild(cellGrau);

					const cellAcorde = document.createElement('td');
					cellAcorde.innerHTML = `
						<strong>${acordeNome}</strong>
						<sup class="fst-italic small text-muted">(${ext9} ${ext11} ${ext13})</sup>
					`;
					linhaAcordes.appendChild(cellAcorde);

					const cellNotas = document.createElement('td');
					cellNotas.className = "notas-destaque small";
					cellNotas.textContent = Tonal.Chord.get(acordeNome).notes.join(', ');
					linhaNotas.appendChild(cellNotas);

					const cellModo = document.createElement('td');
					const nomeModo = infoModo[1].charAt(0).toUpperCase() + infoModo[1].slice(1);
					cellModo.innerHTML = `<span class="fst-italic small">${fundamental} ${nomeModo}</span>`;
					linhaModos.appendChild(cellModo);
				});

			} catch (e) {
				console.error(e);
			}
		}

		window.onload = gerarCampo;
	</script>
</body>
</html>